"""empty message

Revision ID: 211ed80d1f86
Revises: b6832f9c8f54
Create Date: 2026-02-24 10:14:30.937161

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '211ed80d1f86'
down_revision = 'b6832f9c8f54'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('studio_assets',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('kind', sa.String(length=32), nullable=False),
    sa.Column('filename', sa.String(length=255), nullable=True),
    sa.Column('mime_type', sa.String(length=128), nullable=True),
    sa.Column('url', sa.Text(), nullable=False),
    sa.Column('size_bytes', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['user.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('studio_assets', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_studio_assets_user_id'), ['user_id'], unique=False)

    op.create_table('studio_projects',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('bpm', sa.Integer(), nullable=False),
    sa.Column('time_signature', sa.String(length=16), nullable=False),
    sa.Column('master_volume', sa.Float(), nullable=False),
    sa.Column('piano_roll_notes', sa.JSON(), nullable=True),
    sa.Column('piano_roll_key', sa.String(length=8), nullable=True),
    sa.Column('piano_roll_scale', sa.String(length=16), nullable=True),
    sa.Column('ui_state', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['user.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('studio_projects', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_studio_projects_user_id'), ['user_id'], unique=False)

    op.create_table('studio_mixdowns',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('asset_id', sa.Integer(), nullable=True),
    sa.Column('url', sa.Text(), nullable=False),
    sa.Column('filename', sa.String(length=255), nullable=True),
    sa.Column('mime_type', sa.String(length=128), nullable=True),
    sa.Column('size_bytes', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['asset_id'], ['studio_assets.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['studio_projects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('studio_mixdowns', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_studio_mixdowns_project_id'), ['project_id'], unique=False)

    op.create_table('studio_tracks',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('track_index', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('track_type', sa.String(length=16), nullable=False),
    sa.Column('volume', sa.Float(), nullable=False),
    sa.Column('pan', sa.Float(), nullable=False),
    sa.Column('muted', sa.Boolean(), nullable=False),
    sa.Column('solo', sa.Boolean(), nullable=False),
    sa.Column('color', sa.String(length=16), nullable=True),
    sa.Column('effects', sa.JSON(), nullable=True),
    sa.Column('audio_url', sa.Text(), nullable=True),
    sa.Column('asset_id', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['asset_id'], ['studio_assets.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['studio_projects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('project_id', 'track_index', name='uq_studio_tracks_project_track_index')
    )
    with op.batch_alter_table('studio_tracks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_studio_tracks_project_id'), ['project_id'], unique=False)
        batch_op.create_index('ix_studio_tracks_project_id_track_index', ['project_id', 'track_index'], unique=False)

    op.create_table('studio_regions',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('track_id', sa.Integer(), nullable=False),
    sa.Column('region_uid', sa.String(length=80), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=True),
    sa.Column('start_beat', sa.Float(), nullable=False),
    sa.Column('duration', sa.Float(), nullable=False),
    sa.Column('color', sa.String(length=16), nullable=True),
    sa.Column('loop_enabled', sa.Boolean(), nullable=False),
    sa.Column('loop_count', sa.Integer(), nullable=False),
    sa.Column('audio_url', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['track_id'], ['studio_tracks.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('studio_regions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_studio_regions_region_uid'), ['region_uid'], unique=False)
        batch_op.create_index(batch_op.f('ix_studio_regions_track_id'), ['track_id'], unique=False)
        batch_op.create_index('ix_studio_regions_track_start', ['track_id', 'start_beat'], unique=False)

    with op.batch_alter_table('mastering_jobs', schema=None) as batch_op:
        batch_op.add_column(sa.Column('updated_at', sa.DateTime(), nullable=False))

    with op.batch_alter_table('recording_projects', schema=None) as batch_op:
        batch_op.alter_column('status',
               existing_type=sa.VARCHAR(length=20),
               nullable=False)
        batch_op.alter_column('tags',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('bpm',
               existing_type=sa.INTEGER(),
               nullable=False)
        batch_op.alter_column('time_signature_top',
               existing_type=sa.INTEGER(),
               nullable=False)
        batch_op.alter_column('time_signature_bottom',
               existing_type=sa.INTEGER(),
               nullable=False)
        batch_op.alter_column('master_volume',
               existing_type=postgresql.DOUBLE_PRECISION(precision=53),
               nullable=False)
        batch_op.alter_column('metronome_enabled',
               existing_type=sa.BOOLEAN(),
               nullable=False)
        batch_op.alter_column('count_in_enabled',
               existing_type=sa.BOOLEAN(),
               nullable=False)
        batch_op.alter_column('duration_seconds',
               existing_type=postgresql.DOUBLE_PRECISION(precision=53),
               nullable=False)
        batch_op.alter_column('sample_rate',
               existing_type=sa.INTEGER(),
               nullable=False)
        batch_op.alter_column('tracks_json',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('track_audio_urls',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('piano_roll_notes_json',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('piano_roll_key',
               existing_type=sa.VARCHAR(length=5),
               nullable=False)
        batch_op.alter_column('piano_roll_scale',
               existing_type=sa.VARCHAR(length=20),
               nullable=False)
        batch_op.alter_column('mixdown_bit_depth',
               existing_type=sa.INTEGER(),
               nullable=False)
        batch_op.alter_column('mixdown_channels',
               existing_type=sa.INTEGER(),
               nullable=False)
        batch_op.alter_column('is_published',
               existing_type=sa.BOOLEAN(),
               nullable=False)
        batch_op.alter_column('total_size_bytes',
               existing_type=sa.BIGINT(),
               nullable=False)
        batch_op.alter_column('track_count',
               existing_type=sa.INTEGER(),
               nullable=False)
        batch_op.alter_column('created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
        batch_op.alter_column('updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('recording_projects', schema=None) as batch_op:
        batch_op.alter_column('updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
        batch_op.alter_column('created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
        batch_op.alter_column('track_count',
               existing_type=sa.INTEGER(),
               nullable=True)
        batch_op.alter_column('total_size_bytes',
               existing_type=sa.BIGINT(),
               nullable=True)
        batch_op.alter_column('is_published',
               existing_type=sa.BOOLEAN(),
               nullable=True)
        batch_op.alter_column('mixdown_channels',
               existing_type=sa.INTEGER(),
               nullable=True)
        batch_op.alter_column('mixdown_bit_depth',
               existing_type=sa.INTEGER(),
               nullable=True)
        batch_op.alter_column('piano_roll_scale',
               existing_type=sa.VARCHAR(length=20),
               nullable=True)
        batch_op.alter_column('piano_roll_key',
               existing_type=sa.VARCHAR(length=5),
               nullable=True)
        batch_op.alter_column('piano_roll_notes_json',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.alter_column('track_audio_urls',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.alter_column('tracks_json',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.alter_column('sample_rate',
               existing_type=sa.INTEGER(),
               nullable=True)
        batch_op.alter_column('duration_seconds',
               existing_type=postgresql.DOUBLE_PRECISION(precision=53),
               nullable=True)
        batch_op.alter_column('count_in_enabled',
               existing_type=sa.BOOLEAN(),
               nullable=True)
        batch_op.alter_column('metronome_enabled',
               existing_type=sa.BOOLEAN(),
               nullable=True)
        batch_op.alter_column('master_volume',
               existing_type=postgresql.DOUBLE_PRECISION(precision=53),
               nullable=True)
        batch_op.alter_column('time_signature_bottom',
               existing_type=sa.INTEGER(),
               nullable=True)
        batch_op.alter_column('time_signature_top',
               existing_type=sa.INTEGER(),
               nullable=True)
        batch_op.alter_column('bpm',
               existing_type=sa.INTEGER(),
               nullable=True)
        batch_op.alter_column('tags',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.alter_column('status',
               existing_type=sa.VARCHAR(length=20),
               nullable=True)

    with op.batch_alter_table('mastering_jobs', schema=None) as batch_op:
        batch_op.drop_column('updated_at')

    with op.batch_alter_table('studio_regions', schema=None) as batch_op:
        batch_op.drop_index('ix_studio_regions_track_start')
        batch_op.drop_index(batch_op.f('ix_studio_regions_track_id'))
        batch_op.drop_index(batch_op.f('ix_studio_regions_region_uid'))

    op.drop_table('studio_regions')
    with op.batch_alter_table('studio_tracks', schema=None) as batch_op:
        batch_op.drop_index('ix_studio_tracks_project_id_track_index')
        batch_op.drop_index(batch_op.f('ix_studio_tracks_project_id'))

    op.drop_table('studio_tracks')
    with op.batch_alter_table('studio_mixdowns', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_studio_mixdowns_project_id'))

    op.drop_table('studio_mixdowns')
    with op.batch_alter_table('studio_projects', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_studio_projects_user_id'))

    op.drop_table('studio_projects')
    with op.batch_alter_table('studio_assets', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_studio_assets_user_id'))

    op.drop_table('studio_assets')
    # ### end Alembic commands ###
